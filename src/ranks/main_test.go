package main

import (
	"fmt"
	"testing"
	"encoding/json"
)

func TestRankProvider(t *testing.T) {

	sources := []Source{
		Source("abcd efg"),
	}
	targets := []Target{
		Target{Text: "aaaa", Key: "1"},
		Target{Text: "abcd", Key: "2"},
		Target{Text: "abce", Key: "3"},
		Target{Text: "abcefg", Key: "4"},
		Target{Text: "abcd efg", Key: "5"},
		// The following also has a rank of 1 due to a limitation having to weighting subMatch against their source word,
		// instead of weighing against the target string. This is acceptable so far.
		// Target{Text: "abcdefg", Data: "6"},
		Target{Text: "acd fg", Key: "7"},
	}

	res := MatchSourceAndTargets(sources, targets)
	fmt.Println(res)
}

func TestCombine(t *testing.T) {
	var data = `{"targets":[{"text":"1 Series 128i Coupe 2D","key":"https://www.kbb.com/bmw/1-series/2012/128i-coupe-2d/?vehicleid=360950&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"1 Series 135i Coupe 2D","key":"https://www.kbb.com/bmw/1-series/2012/135i-coupe-2d/?vehicleid=360953&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"1 Series 128i Convertible 2D","key":"https://www.kbb.com/bmw/1-series/2012/128i-convertible-2d/?vehicleid=360952&intent=buy-used&category=convertible&modalview=false&pricetype=private-party&condition=good"},{"text":"1 Series 135i Convertible 2D","key":"https://www.kbb.com/bmw/1-series/2012/135i-convertible-2d/?vehicleid=360949&intent=buy-used&category=convertible&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 328i Sedan 4D","key":"https://www.kbb.com/bmw/3-series/2012/328i-sedan-4d/?vehicleid=374152&intent=buy-used&category=sedan&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 335i Sedan 4D","key":"https://www.kbb.com/bmw/3-series/2012/335i-sedan-4d/?vehicleid=374153&intent=buy-used&category=sedan&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 328i xDrive Coupe 2D","key":"https://www.kbb.com/bmw/3-series/2012/328i-xdrive-coupe-2d/?vehicleid=370982&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 328i Coupe 2D","key":"https://www.kbb.com/bmw/3-series/2012/328i-coupe-2d/?vehicleid=370984&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 335i Coupe 2D","key":"https://www.kbb.com/bmw/3-series/2012/335i-coupe-2d/?vehicleid=370980&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 335i xDrive Coupe 2D","key":"https://www.kbb.com/bmw/3-series/2012/335i-xdrive-coupe-2d/?vehicleid=370981&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 335is Coupe 2D","key":"https://www.kbb.com/bmw/3-series/2012/335is-coupe-2d/?vehicleid=370988&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 328i Sport Wagon 4D","key":"https://www.kbb.com/bmw/3-series/2012/328i-sport-wagon-4d/?vehicleid=370986&intent=buy-used&category=wagon&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 328i xDrive Sport Wagon 4D","key":"https://www.kbb.com/bmw/3-series/2012/328i-xdrive-sport-wagon-4d/?vehicleid=370995&intent=buy-used&category=wagon&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 328i Convertible 2D","key":"https://www.kbb.com/bmw/3-series/2012/328i-convertible-2d/?vehicleid=370985&intent=buy-used&category=convertible&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 335i Convertible 2D","key":"https://www.kbb.com/bmw/3-series/2012/335i-convertible-2d/?vehicleid=370987&intent=buy-used&category=convertible&modalview=false&pricetype=private-party&condition=good"},{"text":"3 Series 335is Convertible 2D","key":"https://www.kbb.com/bmw/3-series/2012/335is-convertible-2d/?vehicleid=370992&intent=buy-used&category=convertible&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 528i Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/528i-sedan-4d/?vehicleid=371083&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series ActiveHybrid 5 Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/activehybrid-5-sedan-4d/?vehicleid=377538&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 528i xDrive Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/528i-xdrive-sedan-4d/?vehicleid=371084&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 535i Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/535i-sedan-4d/?vehicleid=371082&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 550i Gran Turismo Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/550i-gran-turismo-sedan-4d/?vehicleid=370951&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 535i Gran Turismo Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/535i-gran-turismo-sedan-4d/?vehicleid=370943&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 550i Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/550i-sedan-4d/?vehicleid=370948&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 535i xDrive Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/535i-xdrive-sedan-4d/?vehicleid=370942&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 550i xDrive Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/550i-xdrive-sedan-4d/?vehicleid=370953&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 550i Gran Turismo xDrive Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/550i-gran-turismo-xdrive-sedan-4d/?vehicleid=370956&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"5 Series 535i Gran Turismo xDrive Sedan 4D","key":"https://www.kbb.com/bmw/5-series/2012/535i-gran-turismo-xdrive-sedan-4d/?vehicleid=370944&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"6 Series 650i Convertible 2D","key":"https://www.kbb.com/bmw/6-series/2012/650i-convertible-2d/?vehicleid=360954&intent=buy-used&category=convertible&modalview=false&pricetype=private-party&condition=good"},{"text":"6 Series 640i Convertible 2D","key":"https://www.kbb.com/bmw/6-series/2012/640i-convertible-2d/?vehicleid=372408&intent=buy-used&category=convertible&modalview=false&pricetype=private-party&condition=good"},{"text":"6 Series 650i xDrive Convertible 2D","key":"https://www.kbb.com/bmw/6-series/2012/650i-xdrive-convertible-2d/?vehicleid=372411&intent=buy-used&category=convertible&modalview=false&pricetype=private-party&condition=good"},{"text":"6 Series 640i Coupe 2D","key":"https://www.kbb.com/bmw/6-series/2012/640i-coupe-2d/?vehicleid=372409&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"6 Series 650i Coupe 2D","key":"https://www.kbb.com/bmw/6-series/2012/650i-coupe-2d/?vehicleid=372405&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"6 Series 650i xDrive Coupe 2D","key":"https://www.kbb.com/bmw/6-series/2012/650i-xdrive-coupe-2d/?vehicleid=372410&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series 740i Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/740i-sedan-4d/?vehicleid=371031&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series 750i Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/750i-sedan-4d/?vehicleid=371035&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series 750Li Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/750li-sedan-4d/?vehicleid=371037&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series 750Li ActiveHybrid Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/750li-activehybrid-sedan-4d/?vehicleid=373362&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series 750i ActiveHybrid Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/750i-activehybrid-sedan-4d/?vehicleid=373361&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series 740Li Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/740li-sedan-4d/?vehicleid=371032&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series 750Li xDrive Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/750li-xdrive-sedan-4d/?vehicleid=371038&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series 750i xDrive Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/750i-xdrive-sedan-4d/?vehicleid=371036&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series Alpina B7 Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/alpina-b7-sedan-4d/?vehicleid=371033&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series 760Li Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/760li-sedan-4d/?vehicleid=373363&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"7 Series Alpina B7 xDrive Sedan 4D","key":"https://www.kbb.com/bmw/7-series/2012/alpina-b7-xdrive-sedan-4d/?vehicleid=371034&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"M3 Convertible 2D","key":"https://www.kbb.com/bmw/m3/2012/convertible-2d/?vehicleid=377588&intent=buy-used&category=convertible&modalview=false&pricetype=private-party&condition=good"},{"text":"M3 Coupe 2D","key":"https://www.kbb.com/bmw/m3/2012/coupe-2d/?vehicleid=377589&intent=buy-used&category=coupe&modalview=false&pricetype=private-party&condition=good"},{"text":"M6 Convertible 2D","key":"https://www.kbb.com/bmw/m6/2012/convertible-2d/?vehicleid=378416&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X3 xDrive28i Sport Utility 4D","key":"https://www.kbb.com/bmw/x3/2012/xdrive28i-sport-utility-4d/?vehicleid=371228&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X3 xDrive35i Sport Utility 4D","key":"https://www.kbb.com/bmw/x3/2012/xdrive35i-sport-utility-4d/?vehicleid=371233&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X5 xDrive35i Sport Utility 4D","key":"https://www.kbb.com/bmw/x5/2012/xdrive35i-sport-utility-4d/?vehicleid=364389&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X5 xDrive50i Sport Utility 4D","key":"https://www.kbb.com/bmw/x5/2012/xdrive50i-sport-utility-4d/?vehicleid=364394&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X5 xDrive35d Sport Utility 4D","key":"https://www.kbb.com/bmw/x5/2012/xdrive35d-sport-utility-4d/?vehicleid=364393&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X5 xDrive35i Sport Activity Sport Utility 4D","key":"https://www.kbb.com/bmw/x5/2012/xdrive35i-sport-activity-sport-utility-4d/?vehicleid=364392&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X5 xDrive35i Premium Sport Utility 4D","key":"https://www.kbb.com/bmw/x5/2012/xdrive35i-premium-sport-utility-4d/?vehicleid=364391&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X5 M Sport Utility 4D","key":"https://www.kbb.com/bmw/x5-m/2012/sport-utility-4d/?vehicleid=377590&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X6 xDrive50i Sport Utility 4D","key":"https://www.kbb.com/bmw/x6/2012/xdrive50i-sport-utility-4d/?vehicleid=363053&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X6 xDrive35i Sport Utility 4D","key":"https://www.kbb.com/bmw/x6/2012/xdrive35i-sport-utility-4d/?vehicleid=363052&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"X6 M Sport Utility 4D","key":"https://www.kbb.com/bmw/x6-m/2012/sport-utility-4d/?vehicleid=377587&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"Z4 sDrive28i Roadster 2D","key":"https://www.kbb.com/bmw/z4/2012/sdrive28i-roadster-2d/?vehicleid=373520&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"Z4 sDrive35i Roadster 2D","key":"https://www.kbb.com/bmw/z4/2012/sdrive35i-roadster-2d/?vehicleid=373522&intent=buy-used&modalview=false&pricetype=private-party&condition=good"},{"text":"Z4 sDrive35is Roadster 2D","key":"https://www.kbb.com/bmw/z4/2012/sdrive35is-roadster-2d/?vehicleid=373521&intent=buy-used&modalview=false&pricetype=private-party&condition=good"}],"sources":["BMW 328i Coupe M Sport Pkg","BMW 328i Coupe M Sport Pakage Low Mileage coupe"]}`

	ranksRequest := RanksRequest{}
	json.Unmarshal([]byte(data), &ranksRequest)
	rankedTarget := MatchSourceAndTargets(ranksRequest.Sources, ranksRequest.Targets)
	fmt.Println(rankedTarget)
}
